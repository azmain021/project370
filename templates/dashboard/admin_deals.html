{% extends "base.html" %}
{% block title %}Admin â€“ Completed Deals{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4">
  <h1 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Completed Deals</h1>

  {% if completed_deals %}
    <div class="space-y-6">
      {% for deal in completed_deals %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden">
          <!-- Deal Header -->
          <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-900/20 px-6 py-4 border-b border-blue-200 dark:border-blue-700">
            <div class="flex justify-between items-start">
              <div>
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                  Booking #{{ deal.booking.id }} - {{ deal.booking.property.title }}
                </h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                  Completed on: {{ deal.seller_amount_sent_at|date:"M d, Y H:i" }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">${{ deal.amount }}</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Total Amount</p>
              </div>
            </div>
          </div>

          <!-- Deal Content -->
          <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Property Details -->
            <div class="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                <i class="fas fa-building mr-2 text-purple-600 dark:text-purple-400"></i>
                Property Details
              </h3>
              <div class="space-y-2 text-sm">
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Address:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.property.address }}, {{ deal.booking.property.city }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Type:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.property.get_property_type_display }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">List Price:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">${{ deal.booking.property.price }}</p>
                </div>
                {% if deal.booking.property.description %}
                  <div>
                    <p class="text-gray-500 dark:text-gray-400">Description:</p>
                    <p class="text-gray-900 dark:text-gray-100 text-xs">{{ deal.booking.property.description|truncatewords:20 }}</p>
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Seller Details -->
            <div class="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                <i class="fas fa-user-tie mr-2 text-green-600 dark:text-green-400"></i>
                Seller Information
              </h3>
              <div class="space-y-2 text-sm">
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Name:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.property.seller.first_name }} {{ deal.booking.property.seller.last_name }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Username:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.property.seller.username }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Email:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium break-all">{{ deal.booking.property.seller.email }}</p>
                </div>
                {% if deal.booking.property.seller.phone_number %}
                  <div>
                    <p class="text-gray-500 dark:text-gray-400">Phone:</p>
                    <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.property.seller.phone_number }}</p>
                  </div>
                {% endif %}
                {% if deal.booking.property.seller.address %}
                  <div>
                    <p class="text-gray-500 dark:text-gray-400">Address:</p>
                    <p class="text-gray-900 dark:text-gray-100 text-xs">{{ deal.booking.property.seller.address }}</p>
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Buyer Details -->
            <div class="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                <i class="fas fa-user-circle mr-2 text-orange-600 dark:text-orange-400"></i>
                Buyer Information
              </h3>
              <div class="space-y-2 text-sm">
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Name:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.tenant.first_name }} {{ deal.booking.tenant.last_name }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Username:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.tenant.username }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Email:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium break-all">{{ deal.booking.tenant.email }}</p>
                </div>
                {% if deal.booking.tenant.phone_number %}
                  <div>
                    <p class="text-gray-500 dark:text-gray-400">Phone:</p>
                    <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.booking.tenant.phone_number }}</p>
                  </div>
                {% endif %}
                {% if deal.booking.tenant.address %}
                  <div>
                    <p class="text-gray-500 dark:text-gray-400">Address:</p>
                    <p class="text-gray-900 dark:text-gray-100 text-xs">{{ deal.booking.tenant.address }}</p>
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Transaction Details -->
            <div class="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg">
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                <i class="fas fa-receipt mr-2 text-blue-600 dark:text-blue-400"></i>
                Transaction Details
              </h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <p class="text-gray-500 dark:text-gray-400">Total Amount:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">${{ deal.amount }}</p>
                </div>
                <div class="flex justify-between border-t border-gray-200 dark:border-gray-600 pt-2">
                  <p class="text-gray-500 dark:text-gray-400">Platform Cut (10%):</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">${{ deal.platform_cut }}</p>
                </div>
                <div class="flex justify-between">
                  <p class="text-gray-500 dark:text-gray-400">Seller Amount:</p>
                  <p class="text-green-600 dark:text-green-400 font-bold">${{ deal.seller_amount }}</p>
                </div>
                <div class="flex justify-between border-t border-gray-200 dark:border-gray-600 pt-2 mt-2">
                  <p class="text-gray-500 dark:text-gray-400">Approved By:</p>
                  <p class="text-gray-900 dark:text-gray-100 font-medium">{{ deal.approved_by_admin.username }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Approved On:</p>
                  <p class="text-gray-900 dark:text-gray-100 text-xs">{{ deal.approved_at|date:"M d, Y H:i" }}</p>
                </div>
                <div>
                  <p class="text-gray-500 dark:text-gray-400">Sent to Seller:</p>
                  <p class="text-gray-900 dark:text-gray-100 text-xs">{{ deal.seller_amount_sent_at|date:"M d, Y H:i" }}</p>
                </div>
              </div>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center border border-gray-200 dark:border-gray-700">
      <i class="fas fa-inbox text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
      <p class="text-gray-500 dark:text-gray-400 text-lg">No completed deals yet.</p>
      <p class="text-gray-500 dark:text-gray-400 text-sm mt-2">Deals will appear here once payments have been sent to sellers.</p>
    </div>
  {% endif %}

</div>
{% endblock %}
